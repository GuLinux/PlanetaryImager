#!/bin/bash
set -e
if [ "${TRAVIS_OS_NAME}" == "linux" ]; then
    source ~/virtualenv/python3.6/bin/activate
    # PACKAGE_VERSION_SUFFIX="$( python3 -c "import datetime; print(datetime.datetime.strptime('$(git show -s --format='%cI')', '%Y-%m-%dT%H:%M:%S%z').strftime('%Y%m%d'))" )"
   ./support/docker/docker.py package -j 4 -d "${TRAVIS_BUILD_DIR}/packages" -b $TRAVIS_BUILD_DIR/build --stderr -D PACKAGE_VERSION_SUFFIX="_$( date +%Y%m%d )_ci${TRAVIS_BUILD_NUMBER}" -i ${DOCKER_IMAGE}
fi

if [ "${TRAVIS_OS_NAME}" == "osx" ]; then
    cd "$TRAVIS_BUILD_DIR/build"
    make package -j4
    mkdir -p "$TRAVIS_BUILD_DIR/packages"
    cp -av *.dmg "$TRAVIS_BUILD_DIR/packages"
fi
